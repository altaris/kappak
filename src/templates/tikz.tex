%% -----------------------------------------------------------------------------
%%
%% tikz
%%
%% -----------------------------------------------------------------------------

\ifthenelse{\boolean{@b_extpack_use_tikz}}{

%% --------------------
%% Alignment
%% --------------------

    \tikzset{baseline=(current bounding box.center)}

%% --------------------
%% Size
%% --------------------

%{% if cmd_diagramsize %}
    \newcommand{\diagramsize}[2]{
        \ifthenelse{\equal{#1}{}}{\def\@tRowsep{2}}{\def\@tRowsep{#1}}
        \ifthenelse{\equal{#2}{}}{\def\@tColsep{3}}{\def\@tColsep{#2}}
    }
    \diagramsize{}{}
%{% endif %}

%% --------------------
%% Styles
%% --------------------

%{% if cmd_diagramarrows %}
    \newcommand{\diagramarrows}[4]{
        \ifthenelse{\equal{#1}{}}{\def\@diagAA{->}}{}
        \ifthenelse{\equal{#1}{-}}{\def\@diagAA{-}}{}
        \ifthenelse{\equal{#1}{->}}{\def\@diagAA{->}}{}
        \ifthenelse{\equal{#1}{<-}}{\def\@diagAA{<-}}{}
        \ifthenelse{\equal{#1}{<->}}{\def\@diagAA{<->}}{}
        \ifthenelse{\equal{#1}{->>}}{\def\@diagAA{->>}}{}
        \ifthenelse{\equal{#1}{<<-}}{\def\@diagAA{<<-}}{}
        \ifthenelse{\equal{#1}{>->}}{\def\@diagAA{>->}}{}
        \ifthenelse{\equal{#1}{<-<}}{\def\@diagAA{<-<}}{}
        \ifthenelse{\equal{#1}{c->}}{\def\@diagAA{right hook->}}{}
        \ifthenelse{\equal{#1}{<-c}}{\def\@diagAA{<-left hook}}{}
        \ifthenelse{\equal{#1}{|->}}{\def\@diagAA{|->}}{}
        \ifthenelse{\equal{#1}{<-|}}{\def\@diagAA{<-|}}{}
        \ifthenelse{\equal{#2}{}}{\def\@diagAB{->}}{}
        \ifthenelse{\equal{#2}{-}}{\def\@diagAB{-}}{}
        \ifthenelse{\equal{#2}{->}}{\def\@diagAB{->}}{}
        \ifthenelse{\equal{#2}{<-}}{\def\@diagAB{<-}}{}
        \ifthenelse{\equal{#2}{<->}}{\def\@diagAB{<->}}{}
        \ifthenelse{\equal{#2}{->>}}{\def\@diagAB{->>}}{}
        \ifthenelse{\equal{#2}{<<-}}{\def\@diagAB{<<-}}{}
        \ifthenelse{\equal{#2}{>->}}{\def\@diagAB{>->}}{}
        \ifthenelse{\equal{#2}{<-<}}{\def\@diagAB{<-<}}{}
        \ifthenelse{\equal{#2}{c->}}{\def\@diagAB{right hook->}}{}
        \ifthenelse{\equal{#2}{<-c}}{\def\@diagAB{<-left hook}}{}
        \ifthenelse{\equal{#2}{|->}}{\def\@diagAB{|->}}{}
        \ifthenelse{\equal{#2}{<-|}}{\def\@diagAB{<-|}}{}
        \ifthenelse{\equal{#3}{}}{\def\@diagAC{->}}{}
        \ifthenelse{\equal{#3}{-}}{\def\@diagAC{-}}{}
        \ifthenelse{\equal{#3}{->}}{\def\@diagAC{->}}{}
        \ifthenelse{\equal{#3}{<-}}{\def\@diagAC{<-}}{}
        \ifthenelse{\equal{#3}{<->}}{\def\@diagAC{<->}}{}
        \ifthenelse{\equal{#3}{->>}}{\def\@diagAC{->>}}{}
        \ifthenelse{\equal{#3}{<<-}}{\def\@diagAC{<<-}}{}
        \ifthenelse{\equal{#3}{>->}}{\def\@diagAC{>->}}{}
        \ifthenelse{\equal{#3}{<-<}}{\def\@diagAC{<-<}}{}
        \ifthenelse{\equal{#3}{c->}}{\def\@diagAC{right hook->}}{}
        \ifthenelse{\equal{#3}{<-c}}{\def\@diagAC{<-left hook}}{}
        \ifthenelse{\equal{#3}{|->}}{\def\@diagAC{|->}}{}
        \ifthenelse{\equal{#3}{<-|}}{\def\@diagAC{<-|}}{}
        \ifthenelse{\equal{#4}{}}{\def\@diagAD{->}}{}
        \ifthenelse{\equal{#4}{-}}{\def\@diagAD{-}}{}
        \ifthenelse{\equal{#4}{->}}{\def\@diagAD{->}}{}
        \ifthenelse{\equal{#4}{<-}}{\def\@diagAD{<-}}{}
        \ifthenelse{\equal{#4}{<->}}{\def\@diagAD{<->}}{}
        \ifthenelse{\equal{#4}{->>}}{\def\@diagAD{->>}}{}
        \ifthenelse{\equal{#4}{<<-}}{\def\@diagAD{<<-}}{}
        \ifthenelse{\equal{#4}{>->}}{\def\@diagAD{>->}}{}
        \ifthenelse{\equal{#4}{<-<}}{\def\@diagAD{<-<}}{}
        \ifthenelse{\equal{#4}{c->}}{\def\@diagAD{right hook->}}{}
        \ifthenelse{\equal{#4}{<-c}}{\def\@diagAD{<-left hook}}{}
        \ifthenelse{\equal{#4}{|->}}{\def\@diagAD{|->}}{}
        \ifthenelse{\equal{#4}{<-|}}{\def\@diagAD{<-|}}{}
    }
%{% endif %}

%{% if cmd_diagramlines %}
    \newcommand{\diagramlines}[4]{
        \ifthenelse{\equal{#1}{}}{\def\@diagLA{solid}}{}
        \ifthenelse{\equal{#1}{=}}{\def\@diagLA{double}}{}
        \ifthenelse{\equal{#1}{-}}{\def\@diagLA{solid}}{}
        \ifthenelse{\equal{#1}{..}}{\def\@diagLA{dotted}}{}
        \ifthenelse{\equal{#1}{--}}{\def\@diagLA{dashed}}{}
        \ifthenelse{\equal{#2}{}}{\def\@diagLB{solid}}{}
        \ifthenelse{\equal{#2}{=}}{\def\@diagLB{double}}{}
        \ifthenelse{\equal{#2}{-}}{\def\@diagLB{solid}}{}
        \ifthenelse{\equal{#2}{..}}{\def\@diagLB{dotted}}{}
        \ifthenelse{\equal{#2}{--}}{\def\@diagLB{dashed}}{}
        \ifthenelse{\equal{#3}{}}{\def\@diagLC{solid}}{}
        \ifthenelse{\equal{#3}{=}}{\def\@diagLC{double}}{}
        \ifthenelse{\equal{#3}{-}}{\def\@diagLC{solid}}{}
        \ifthenelse{\equal{#3}{..}}{\def\@diagLC{dotted}}{}
        \ifthenelse{\equal{#3}{--}}{\def\@diagLC{dashed}}{}
        \ifthenelse{\equal{#4}{}}{\def\@diagLD{solid}}{}
        \ifthenelse{\equal{#4}{=}}{\def\@diagLD{double}}{}
        \ifthenelse{\equal{#4}{-}}{\def\@diagLD{solid}}{}
        \ifthenelse{\equal{#4}{..}}{\def\@diagLD{dotted}}{}
        \ifthenelse{\equal{#4}{--}}{\def\@diagLD{dashed}}{}
    }
%{% endif %}

%% --------------------
%% Reset styles
%% --------------------

%{% if cmd_rds %}
    \newcommand{\rds}{
        \diagramarrows{}{}{}{}
        \diagramlines{}{}{}{}
    }
    \rds
%{% endif %}

%% --------------------
%% Simple square
%% --------------------

%{% if cmd_squarediagram %}
    \newcommand{\squarediagram}[8]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5 ex,
                    text depth = 0.25 ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \\
                {#3} \@ampersand {#4} \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above] {$\scriptstyle{#5}$} (m-1-2);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [left]  {$\scriptstyle{#6}$} (m-2-1);
            \path [\@diagAC] (m-1-2) edge [\@diagLC] node [right] {$\scriptstyle{#7}$} (m-2-2);
            \path [\@diagAD] (m-2-1) edge [\@diagLD] node [above] {$\scriptstyle{#8}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Pushout
%% --------------------

%{% if cmd_pushoutdiagram %}
    \newcommand{\pushoutdiagram}[8]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5 ex,
                    text depth = 0.25 ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \\
                {#3} \@ampersand {#4} \\
            };
            \path (m-1-1) edge [-, draw = white] node [very near end] {$\ulcorner$} (m-2-2);
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above] {$\scriptstyle{#5}$} (m-1-2);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [left]  {$\scriptstyle{#6}$} (m-2-1);
            \path [\@diagAC] (m-1-2) edge [\@diagLC] node [right] {$\scriptstyle{#7}$} (m-2-2);
            \path [\@diagAD] (m-2-1) edge [\@diagLD] node [above] {$\scriptstyle{#8}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Pullback
%% --------------------

%{% if cmd_pullbackdiagram %}
    \newcommand{\pullbackdiagram}[8]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5 ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \\
                {#3} \@ampersand {#4} \\
            };
            \path (m-1-1) edge [-, draw = white] node [very near start] {$\lrcorner$} (m-2-2);
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above] {$\scriptstyle{#5}$} (m-1-2);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [left]  {$\scriptstyle{#6}$} (m-2-1);
            \path [\@diagAC] (m-1-2) edge [\@diagLC] node [right] {$\scriptstyle{#7}$} (m-2-2);
            \path [\@diagAD] (m-2-1) edge [\@diagLD] node [above] {$\scriptstyle{#8}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular UL : Up left
%% --------------------

%{% if cmd_triangleULdiagram %}
    \newcommand{\triangleULdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5 ex,
                    text depth = 0.25 ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \\
                {#3} \@ampersand      \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above]       {$\scriptstyle{#4}$} (m-1-2);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [left]        {$\scriptstyle{#5}$} (m-2-1);
            \path [\@diagAC] (m-2-1) edge [\@diagLC] node [below right] {$\scriptstyle{#6}$} (m-1-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular UR : Up right
%% --------------------

%{% if cmd_triangleURdiagram %}
    \newcommand{\triangleURdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \\
                     \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above]      {$\scriptstyle{#4}$} (m-1-2);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [below left] {$\scriptstyle{#5}$} (m-2-2);
            \path [\@diagAC] (m-1-2) edge [\@diagLC] node [right]      {$\scriptstyle{#6}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular DL : Down left
%% --------------------

%{% if cmd_triangleDLdiagram %}
    \newcommand{\triangleDLdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand      \\
                {#2} \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [left]        {$\scriptstyle{#4}$} (m-2-1);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [above right] {$\scriptstyle{#5}$} (m-2-2);
            \path [\@diagAC] (m-2-1) edge [\@diagLC] node [below]       {$\scriptstyle{#6}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular DR : Down right
%% --------------------

%{% if cmd_triangleDRdiagram %}
    \newcommand{\triangleDRdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                     \@ampersand {#1} \\
                {#2} \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-2-1) edge [\@diagLA] node [above left] {$\scriptstyle{#4}$} (m-1-2);
            \path [\@diagAB] (m-1-2) edge [\@diagLB] node [right]      {$\scriptstyle{#5}$} (m-2-2);
            \path [\@diagAC] (m-2-1) edge [\@diagLC] node [above]      {$\scriptstyle{#6}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular U : Up
%% --------------------

%{% if cmd_triangleUdiagram %}
    \newcommand{\triangleUdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                     \@ampersand {#1} \@ampersand      \\
                {#2} \@ampersand      \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-1-2) edge [\@diagLA] node [above left]  {$\scriptstyle{#4}$} (m-2-1);
            \path [\@diagAB] (m-1-2) edge [\@diagLB] node [above right] {$\scriptstyle{#5}$} (m-2-3);
            \path [\@diagAC] (m-2-1) edge [\@diagLC] node [above]       {$\scriptstyle{#6}$} (m-2-3);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular L : Left
%% --------------------
%{% if cmd_triangleLdiagram %}
    \newcommand{\triangleLdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                     \@ampersand {#1} \\
                {#2} \@ampersand      \\
                     \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-2-1) edge [\@diagLA] node [above left] {$\scriptstyle{#4}$} (m-1-2);
            \path [\@diagAB] (m-1-2) edge [\@diagLB] node [right]      {$\scriptstyle{#5}$} (m-3-2);
            \path [\@diagAC] (m-2-1) edge [\@diagLC] node [below left] {$\scriptstyle{#6}$} (m-3-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular R : Right
%% --------------------

%{% if cmd_triangleRdiagram %}
    \newcommand{\triangleRdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand      \\
                     \@ampersand {#2} \\
                {#3} \@ampersand      \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [left]        {$\scriptstyle{#4}$} (m-3-1);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [above right] {$\scriptstyle{#5}$} (m-2-2);
            \path [\@diagAC] (m-3-1) edge [\@diagLC] node [below right] {$\scriptstyle{#6}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Triangular D : Down
%% --------------------

%{% if cmd_triangleDdiagram %}
    \newcommand{\triangleDdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand      \@ampersand {#2} \\
                     \@ampersand {#3} \@ampersand      \\
            };
            \path [\@diagAA] (m-1-1) edge [\@diagLA] node [above]       {$\scriptstyle{#4}$} (m-1-3);
            \path [\@diagAB] (m-1-1) edge [\@diagLB] node [below left]  {$\scriptstyle{#5}$} (m-2-2);
            \path [\@diagAC] (m-1-3) edge [\@diagLC] node [below right] {$\scriptstyle{#6}$} (m-2-2);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Equalizer
%% --------------------

%{% if cmd_eqdiagram %}
    \newcommand{\eqdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \@ampersand {#3} \\
            };
            \path [\@diagAA] (m-1-1)                    edge [\@diagLA] node [above] {$\scriptstyle{#4}$} (m-1-2);
            \path [\@diagAB] ($(m-1-2.east) + (0,0.1)$) edge [\@diagLB] node [above] {$\scriptstyle{#5}$} ($(m-1-3.west) + (0,0.1)$);
            \path [\@diagAC] ($(m-1-2.east) - (0,0.1)$) edge [\@diagLC] node [below] {$\scriptstyle{#6}$} ($(m-1-3.west) - (0,0.1)$);
        \end{tikzpicture}
    }
%{% endif %}

%% --------------------
%% Coequalizer
%% --------------------

%{% if cmd_coeqdiagram %}
    \newcommand{\coeqdiagram}[6]{
        \begin{tikzpicture}
            \matrix (m) [matrix of math nodes,
                    row sep = \@tRowsep em,
                    column sep = \@tColsep em,
                    text height = 1.5ex,
                    text depth = 0.25ex,
                    ampersand replacement = \@ampersand] {
                {#1} \@ampersand {#2} \@ampersand {#3} \\
            };
            \path [\@diagAA] ($(m-1-1.east) + (0,0.1)$) edge [\@diagLA] node [above] {$\scriptstyle{#4}$} ($(m-1-2.west) + (0,0.1)$);
            \path [\@diagAB] ($(m-1-1.east) - (0,0.1)$) edge [\@diagLB] node [below] {$\scriptstyle{#5}$} ($(m-1-2.west) - (0,0.1)$);
            \path [\@diagAC] (m-1-2)                    edge [\@diagLC] node [above] {$\scriptstyle{#6}$} (m-1-3);
        \end{tikzpicture}
    }
%{% endif %}

}{}