%% The MIT License (MIT)
%% 
%% Copyright (c) 2014 CÃ©dric Ho Thanh
%% 
%% Permission is hereby granted, free of charge, to any person obtaining a copy
%% of this software and associated documentation files (the "Software"), to deal
%% in the Software without restriction, including without limitation the rights
%% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
%% copies of the Software, and to permit persons to whom the Software is
%% furnished to do so, subject to the following conditions:
%% 
%% The above copyright notice and this permission notice shall be included in all
%% copies or substantial portions of the Software.
%% 
%% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
%% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
%% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
%% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
%% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
%% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
%% SOFTWARE.

%% Processes the arguments given to kappak

\ProvidesFile{kappak-arguments.tex}[Part of kappak package]

%% ----------------------------------------
%%
%% Arguments processing.
%%
%% ----------------------------------------

%% ----------------------------------------
%% Loading required packages.
%% ----------------------------------------

\RequirePackage{keyval}

%% ----------------------------------------
%% Preparing keyval arguments processing.
%% Code taken from
%% http://www.tuteurs.ens.fr/logiciels/latex/nouveau_package.html .
%% ----------------------------------------

\@ifundefined{my@unusedlist}{
  \let\my@unusedlist\@empty}{}
\@ifundefined{my@extractkey}{%
  \def\my@extractkey#1=#2\my@extractkey{#1}}{}
\newcommand{\ProcessUnusedOptions}[1]{%
  \let\my@tempa\@empty
  \let\my@tempb\@empty
  \@for\CurrentOption:=\my@unusedlist\do{%
    \expandafter\expandafter\expandafter\def
    \expandafter\expandafter\expandafter\my@key
    \expandafter\expandafter\expandafter{%
      \expandafter\my@extractkey\CurrentOption=\my@extractkey}%
    \@ifundefined{KV@#1@\my@key}{%
      \edef\my@tempa{\my@tempa,\CurrentOption,}}{%
      \edef\my@tempb{\my@tempb,\CurrentOption,}}}%
  \@for\CurrentOption:=\my@tempa\do{%
    \ifx\CurrentOption\@empty\else
      \PackageWarning{mypack}{`\CurrentOption' not defined.}\fi}%
  \edef\my@tempb{%
    \noexpand\setkeys{#1}{\my@tempb}}%
  \my@tempb
  \AtEndOfPackage{\let\@unprocessedoptions\relax}}

\DeclareOption*{%
  \expandafter\expandafter\expandafter\def
  \expandafter\expandafter\expandafter\my@unusedlist
  \expandafter\expandafter\expandafter{%
    \expandafter\my@unusedlist\expandafter,%
    \CurrentOption}}

%% ----------------------------------------
%% Recieving options
%% ----------------------------------------

%% --------------------
%% Version
%% --------------------

\DeclareOption{alpha}{
    \def\@usedVersion{0407}
}

\DeclareOption{bellatrix}{
    \def\@usedVersion{0409}
}

\DeclareOption{cortana}{
    \def\@usedVersion{0410}
}

\DeclareOption{durotan}{
    \def\@usedVersion{0411}
}

\DeclareOption{eientei}{
    \def\@usedVersion{0412}
}

%% --------------------
%% Simple
%% --------------------

%% +maths
\DeclareOption{+maths}{
    \setboolean{@b_maths_use_arrows}{true}
    \setboolean{@b_maths_use_categories}{true}
    \setboolean{@b_maths_use_characterAccents}{true}
    \setboolean{@b_maths_use_characterStyles}{true}
    \setboolean{@b_maths_use_misc}{true}
    \setboolean{@b_maths_use_operators}{true}
    \setboolean{@b_maths_use_theoremEnvs}{true}
}

%% +maths.misc
\DeclareOption{+maths.arrows}{
    \setboolean{@b_maths_use_arrows}{true}
}

%% +maths.categories
\DeclareOption{+maths.categories}{
    \setboolean{@b_maths_use_categories}{true}
}

%% +maths.characterAccents
\DeclareOption{+maths.characterAccents}{
    \setboolean{@b_maths_use_characterAccents}{true}
}

%% +maths.characterStyles
\DeclareOption{+maths.characterStyles}{
    \setboolean{@b_maths_use_characterStyles}{true}
}

%% +maths.misc
\DeclareOption{+maths.misc}{
    \setboolean{@b_maths_use_misc}{true}
}

%% +maths.operators
\DeclareOption{+maths.operators}{
    \setboolean{@b_maths_use_operators}{true}
}

%% +maths.theoremEnvs
\DeclareOption{+maths.theoremEnvs}{
    \setboolean{@b_maths_use_theoremEnvs}{true}
}

%% +maths.theoremStyles
\DeclareOption{-maths.theoremStyles}{
    \setboolean{@b_maths_use_theoremStyles}{false}
}

%% +misc
\DeclareOption{-misc}{
    \setboolean{@b_use_misc}{false}
}

%% +tikz
\DeclareOption{+tikz}{
    \setboolean{@b_extpack_use_tikz}{true}
}

%% --------------------
%% Keyval
%% --------------------

%% bbStyle
\define@key{kappak}{bbStyle}[normal]{
    \def\@bbStyle{#1}
}

%% bibliographyStyle
\define@key{kappak}{bibliographyStyle}[normal]{
    \def\@bibliographyStyle{#1}
}

%% categoryStyle
\define@key{kappak}{categoryStyle}[script]{
    \def\@categoryStyle{#1}
}

%% chapterStyle
\define@key{kappak}{chapterStyle}[normal]{
    \def\@chapterStyle{#1}
}

%% fontset
\define@key{kappak}{fontSet}[normal]{
    \def\@fontSet{#1}
}

%% headerFooterStyle
\define@key{kappak}{headerFooterStyle}[normal]{
    \def\@headerFooterStyle{#1}
}

%% language
\define@key{kappak}{language}[english]{
    \def\@language{#1}
}

%% lineSpacing
\define@key{kappak}{lineSpacing}[1]{
    \renewcommand{\baselinestretch}{#1} 
}

%% margins
\define@key{kappak}{margins}[normal]{
    \def\@margins{#1}
}

%% scriptStyle
\define@key{kappak}{scriptStyle}[normal]{
    \def\@scriptStyle{#1}
}

%% titlePageStyle
\define@key{kappak}{titlePageStyle}[normal]{
    \def\@titlePageStyle{#1}
}

%% version
\define@key{kappak}{version}[0406]{
    % 0406 is the version where \@kappakVersion started to be taken into account.
    \def\@usedVersion{#1}
}

\ProcessOptions
\ProcessUnusedOptions{kappak}

%% ----------------------------------------
%% Processing
%% ----------------------------------------

\RequirePackage[\@language]{babel}
\RequirePackage[T1]{fontenc}

\RequirePackage{amsfonts}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{mathtools}

\RequirePackage{color}
\RequirePackage{enumerate}
\RequirePackage{graphicx}
\RequirePackage{hyperref}
\RequirePackage{makeidx}
\RequirePackage{microtype}
\RequirePackage{multicol}
\RequirePackage{subfig}
\RequirePackage{titling}

\hypersetup{ % See https://en.wikibooks.org/wiki/LaTeX/Hyperlinks#Customization
    colorlinks=false,
    hidelinks=true,
    linktoc=all,
    unicode=true
}

\newcommand{\@bb}{\mathbb}
\ifthenelse{\equal{\@bbStyle}{bbold}}{
    \RequirePackage{bbold}
}{}

\ifthenelse{\boolean{@b_extpack_use_tikz}}{
    \RequirePackage{tikz}
    \usetikzlibrary{matrix, arrows, calc}
}{}

\ifthenelse{\boolean{@b_maths_use_misc}}{
    \RequirePackage{xeCJK}
}{}

\ifthenelse{\equal{\@chapterStyle}{normal}}{}{
    \RequirePackage{titlesec}
}

\ifthenelse{\equal{\@headerFooterStyle}{normal}}{}{
    \RequirePackage{fancyhdr}
    \RequirePackage{lastpage}
}

\newcommand{\@cal}{\mathcal}
\ifthenelse{\equal{\@scriptStyle}{euler}}{
    \RequirePackage[mathscr]{euscript}
    \renewcommand{\@cal}{\mathscr}
}{}
\ifthenelse{\equal{\@scriptStyle}{rsfs}}{
    \RequirePackage{mathrsfs}
    \renewcommand{\@cal}{\mathscr}
}{}
\ifthenelse{\equal{\@scriptStyle}{rsfso}}{
    \RequirePackage{rsfso}
}{}

\ifthenelse{\equal{\@fontSet}{alternate}}{
    \RequirePackage{mathptmx}       % selects Times Roman as basic font
    \RequirePackage{helvet}         % selects Helvetica as sans-serif font
    \RequirePackage{courier}        % selects Courier as typewriter font
}{}
\ifthenelse{\equal{\@fontSet}{xcharter}}{
    \RequirePackage{XCharter}
}{}

\ifthenelse{\equal{\@margins}{reduced}}{
    \RequirePackage{geometry}
    \geometry{hscale = 0.8, vscale = 0.8, centering}
}{}

\ifthenelse{\equal{\@margins}{minimal}}{
    \RequirePackage{geometry}
    \geometry{margin = 0.5in, centering}
}{}

\ifthenelse{\@usedVersion < \@kappakVersion}{
    \PackageWarning{kappak-v4}{You are using an older version of kappak (v\@usedVersion, actual is v\@kappakVersion).}
}{}